# This is the main server block that listens on port 80.
server {
    listen 80;
    server_name localhost;

    # Root directory for the frontend files.
    # The Vue.js build output is placed in /usr/share/nginx/html by the Dockerfile.
    root /usr/share/nginx/html;
    index index.html;

    # This location block handles all requests.
    # 'try_files' is used to serve the requested file if it exists,
    # otherwise, it falls back to serving index.html.
    # This is crucial for single-page applications (SPAs) like Vue,
    # as it allows client-side routing to work correctly.
    # For example, if a user navigates to /some-route, Nginx will still serve index.html,
    # and Vue Router will handle the /some-route part.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # This location block proxies API requests to the backend service.
    # Any request starting with /api will be forwarded to the backend container.
    location /api {
        # 'proxy_pass' sets the address of the backend service.
        # 'backend' is the service name defined in docker-compose.yaml,
        # and Docker's internal DNS will resolve it to the backend container's IP address.
        # Port 5000 is where the Flask app is running.
        proxy_pass http://backend:5000;

        # These headers are important for passing information about the original request
        # to the backend.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
